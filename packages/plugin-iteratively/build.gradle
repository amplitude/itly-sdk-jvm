plugins {
    id 'org.jetbrains.kotlin.multiplatform'
    id 'maven-publish'
}

repositories {
    google()
    jcenter()
    mavenCentral()
}

kotlin {
    jvm("jvm") {
        compilations.main.kotlinOptions {
            // Setup the Kotlin compiler options for the 'main' compilation:
            jvmTarget = "1.8"
        }
    }

//    presets.withType(org.jetbrains.kotlin.gradle.plugin.mpp.KotlinJvmTargetPreset).each {
//        targetFromPreset(it) {
//            jar {
//                archiveName "plugin-iteratively.jar"
//            }
//        }
//    }

//    targets.fromPreset(presets.jvm, "jvm") {
//        compilations.all {
//            artifacts {
//                artifactId "plugin-iteratively"
//            }
//        }
//    }

    targets.all {
        compilations.all {
            kotlinOptions {
                allWarningsAsErrors = false
            }
        }
    }

    sourceSets {
        // JVM
        jvmMain {
            dependencies {
                implementation kotlin('stdlib-jdk8')
                implementation project(":packages:sdk")
                implementation("net.jodah:failsafe:2.4.0")
                implementation(rootProject.findProperty("okHttpImplementation"))
                implementation(rootProject.findProperty("orgJsonImplementation"))
            }
        }
        jvmTest {
            dependencies {
                implementation kotlin('test')
                implementation kotlin('test-junit5')
                implementation kotlin('test-annotations-common')
                implementation project(":packages:test-fixtures")
//                implementation(rootProject.findProperty("jUnitImplementation"))
                implementation(rootProject.findProperty("mockWebServerImplementation"))
            }
        }
    }
}

// FIXME: How do we rename the JAR artifact to remove '-jvm'?
//def ARTIFACT_ID = 'plugin-iteratively'
//afterEvaluate {
//    project.publishing.publications.all {
//        println(it.name)
//        println(it.artifactId)
//        // rename artifacts
////        groupId = GROUP_ID
//        if (it.artifactId.contains('jvm')) {
//            it.artifactId = "$ARTIFACT_ID"
//            println("New id: " + it.artifactId)
//        } else {
//            artifactId = "$ARTIFACT_ID-$name"
//        }
//    }
//}
